# BPHT Evaluation Workflow

Evaluates the access and fill times of BPHTs compared to an implementation with a dedicated hop bit table.
This includes tests with randomized keys as well as with q-grams from reference genomes.
Plots generated by this workflow are stored in the results folder.

## Requirements

This snakemake workflow executes several evaluation programs from the `bpht_eval` rust program.
In default configuration, only a small amount of the evaluations are performed.
For the full workflow, change the configuration file in the `Snakefile` from `"config_desktop.yaml"` to `"config_server.yaml"`.
Additionally, two genomes used for the evaluation (hg38 __[1]__ and the hops genome __[2]__ ) need to be added to the genomes folder:

- Download the respective genomes
- Add paths to the genome files to `genomes.tsv`
- Change the genome variables in the target file definitions in the `Snakefile` to incorporate the added genome files.
  For exmaple:
  ```python
  genome=["mxanthus", "pfalciparum", "hops", "hg38"],
  ```

This workflow requires `numactl` to be installed:

```bash
sudo apt install numactl
```

Note that the full workflow (using `"config_server.yaml"`) requires several TB of disk space as well as 128 GB of RAM.

## Usage

Note that the access time comparison was designed to run on a specific compute server with two numa blocks.
This evaluation code might not translate to another architecture.

```bash
snakemake --use-conda --jobs 2 --resource numa_0=1 --resource numa_1=1
```

Without specifying numa blocks, numa crossover due to high memory requirements can obfuscate the results.


## References

[1] https://www.ncbi.nlm.nih.gov/assembly/GCF_000001405.39

[2] http://hopbase.cgrb.oregonstate.edu/content/Shinshuwase/hopbase.shinsuwase.fasta.gz
